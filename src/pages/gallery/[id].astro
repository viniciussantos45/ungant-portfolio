---
import ImagesGallery from "../../components/ui/images-gallery";
import VideosGallery from "../../components/ui/videos-gallery";
import ProjectInfo from "../../components/react/ProjectInfo";
import { projectItems } from "../../data/projects";
import PrincipalLayout from "../../layouts/PrincipalLayout.astro";

export async function getStaticPaths() {
  return projectItems.map((project) => ({
    params: { id: project.id },
    props: { project },
  }));
}

const { project } = Astro.props;

// Prepare photos for the images gallery
const imageItems = project.photos.map((photo) => ({
  title: `${project.title} - Photo`,
  description: project.description,
  src: photo.src,
  thumb: photo.src,
  alt: `${project.title} photo`,
}));

// Prepare videos for the videos gallery
const videoItems = project.videos.map((video, index) => ({
  title: `${project.title} - Video ${index + 1}`,
  description: project.description,
  src: video.src,
  thumb: project.image, // Use project cover as thumbnail for videos
  alt: `${project.title} video`,
}));
---

<PrincipalLayout>
  <div class="relative">
    {/* Animated Background */}
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
      <div class="absolute top-0 right-20 w-96 h-96 bg-primary/10 rounded-full filter blur-3xl opacity-40 animate-blob"></div>
      <div class="absolute bottom-40 left-20 w-80 h-80 bg-primary/5 rounded-full filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
    </div>

    <div class="px-4 lg:px-8 py-8 md:py-12 relative z-10">
      <div class="max-w-7xl mx-auto">
        {/* Header */}
        <div class="mb-12 md:mb-16">
          <a href="/projetos" class="inline-flex items-center gap-2 text-secondary hover:text-primary transition-colors mb-6 group animate-fadeInUp opacity-0" style="animation-delay: 0.1s;">
            <svg class="w-5 h-5 transform group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            <span class="font-semibold">Voltar aos Projetos</span>
          </a>
          <h1 class="text-4xl md:text-6xl lg:text-7xl font-black text-primary mb-6 animate-fadeInUp opacity-0" style="animation-delay: 0.2s;">{project.title}</h1>
          <p class="text-xl md:text-2xl text-secondary leading-relaxed mb-3 animate-fadeInUp opacity-0" style="animation-delay: 0.3s;">{project.description}</p>
          <p class="text-base md:text-lg text-secondary/70 animate-fadeInUp opacity-0" style="animation-delay: 0.4s;">{project.subtitle}</p>
        </div>

        {/* Main Content with Sidebar */}
        <div class="grid lg:grid-cols-[1fr_320px] gap-12">
          {/* Gallery Content */}
          <div class="space-y-16 md:space-y-20">
            {/* Videos Section */}
            {
              videoItems.length > 0 && (
                <section class="animate-fadeInUp opacity-0" style="animation-delay: 0.5s;">
                  <h2 class="text-2xl md:text-3xl font-bold text-foreground mb-8">Vídeos</h2>
                  <VideosGallery client:load videos={videoItems} />
                </section>
              )
            }

            {/* Images Section */}
            {
              imageItems.length > 0 && (
                <section class="animate-fadeInUp opacity-0" style="animation-delay: 0.6s;">
                  <h2 class="text-2xl md:text-3xl font-bold text-foreground mb-8">Fotos</h2>
                  <ImagesGallery client:load images={imageItems} />
                </section>
              )
            }

            {
              imageItems.length === 0 && videoItems.length === 0 && (
                <div class="text-center py-20">
                  <p class="text-lg text-secondary/60">Nenhuma mídia disponível para este projeto.</p>
                </div>
              )
            }
          </div>

          {/* Sidebar */}
          <aside class="lg:sticky lg:top-24 lg:self-start">
            <ProjectInfo client:load project={project} />
          </aside>
        </div>
      </div>
    </div>
  </div>
  </div>
</PrincipalLayout>
